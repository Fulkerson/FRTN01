latexfile = report
#cpdir = ../../docs

all: $(latexfile).pdf

#failtable.tex:
#	../src/failbench.py > failtable.tex

$(latexfile).pdf : $(latexfile).tex vc.tex
	while (xelatex -shell-escape $(latexfile).tex ; \
	grep -q "Rerun to get cross" $(latexfile).log ) do true ; \
	done
#	mkdir -p $(cpdir)
#	cp $(latexfile).pdf $(cpdir)

vc.tex: ../.git/logs/HEAD
	echo "%%% This file is generated by Makefile." > vc.tex
	echo "%%% Do not edit this file!\n%%%" >> vc.tex
	echo "\\gdef\\GITTag{"`git describe`"}" >> vc.tex
	git log -1 --date="short" --format="format:\
		\\gdef\\GITAbrHash{%h}\
		\\gdef\\GITDate{%ad}\
		\\gdef\\GITAuthorName{%an}" >> vc.tex

clean:
	rm -rf $(latexfile).aux $(latexfile).log $(latexfile).out\
	     vc.tex $(latexfile).pdf $(latexfile).pyg $(latexfile).toc
