%\documentclass{tufte-handout}
\documentclass{article}
\usepackage{amsmath,amsthm}
\usepackage{fontspec}
%\usepackage{unicode-math}
%\setmathfont{Palatino Linotype}
%\setmainfont{Palatino Linotype}
%\usepackage{minted}
%\usemintedstyle{bw}
\usepackage{hyperref}

%\input{vc.tex}

%\newtheorem{claim}{Claim}[section]
\title{Control of Batch Tank using Raspberry Pi \\ FRTN01 project - Group 20}
%\date{\GITDate,\\\small\GITAbrHash}
\date{}
\author{Johan Anderholm \\ Jonathan Kämpe \\ Mikael Sahlström \\ Mikael Nilsson}

\begin{document}
\maketitle
\newpage
\tableofcontents
\newpage
\section{Problem description}
% An introduction that states the problem that has been solved.
This project aims to control a process called batchprocess that consists of a batchtank, two pumps (one for pumping into the tank and one to pump out of the tank), a heater, a cooler and a mixer. As stated in the project descriptions \cite[p.~6]{project12}, we should simultaneously control the level and temperature in the tank while simulating an exothermic chemical reaction.

This means that the heater will simulate the exothermic reaction and we'll use the cooler and in pump to control the temperature. The out pump will then be used to control the level.

\section{Program structure}
% A section describing the main program structure, both from a class
% and and a real-time perspective. If possible illustrate this with some
% type of figure.
This project is designed as a two-tier client/server system \cite[p.~6]{clientserver} where none of the control processes need to be directly connected to the batch tank.

The server contains of a driver that communicates with the batch tank over a serial interface and the server part of the server that receives connections from clients and serves them with desired data and redirects control signals from clients to the driver which sends them to the batch tank. The communication between the server and its clients is done via the TCP/IP protocol which means that the clients can be located anywhere. In our tests we have had clients running on the same device as the server and on separate devices connected through a switch and TP-cable.

\subsection{Server}

\subsection{Driver}

\subsection{PID client}

\subsection{Plot client}
The plot client, written in Python \cite{python}, is in itself a server/client system where the server is a client to the main server and the clients are web browsers running the Javascript plotting code. When started, a HTTP server will start serving a HTML and Javascript page which is to be run in a browser. This page will request new data to plot from the HTTP server which then requests data from the main server. The main server then sends data (such as water level, control signals and reference signals) to the HTTP server which parses it into JSON \cite{json} formatted data and sends it to the plot page. The data format is as follows:
\begin{verbatim}
{"Plot name": { "Curve name": [y value, ...], ... }, ... }
\end{verbatim}
The data will be received and parsed by Javascript code which will go through it step by step. First, it checks if a plot exists, if not it is created, and then if the curves exists in the plot, if not they are created, and then shifts in the y values onto the curve data. The curve data will initially contain 100 zeros onto which the curve data is shifted from the right. The same amount of data is shifted out from the left so that the curve always contains 100 data points. This will create an effect where the data flows from the right to the left smoothly.

\section{Control design}
% A section describing the control design aspects of the project.


\section{Running the system}
% A section describing the user interface in the project including a short
% HowTo description on how to start and operate the program.
To start the system one should first connect a device to the batch tank and the serial connection to a USB port using a serial to USB adapter. After connecting the device to the batch tank start the server named batchtank\_server and it will start listening for incoming TCP connections from clients. Run these on either the same device as the server or on separate devices connected, via TCP/IP, to the server.

\section{Results}
% A section containing the results. In case the project is a control-oriented
% project this should include plots of measurement signals, reference sig-
% nal, and control signal. If the project is more of a real-time nature then
% this section could contain measurement results of different type.

\section{Conclusion}
% A conclusion section.

\newpage

\begin{thebibliography}{9}
\bibitem{clientserver}
Kusarige, V. (2006), \emph{Client/server technology}, Southern Connecticut State University.
\bibitem{json}
\url{http://www.json.org}
\bibitem{python}
\url{http://python.org}
\bibitem{project12}
\url{http://www.control.lth.se/media/Education/EngineeringProgram/FRTN01/2012/projects12.pdf}
\end{thebibliography}

\end{document}
