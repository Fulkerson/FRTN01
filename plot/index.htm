<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>plot</title>
		<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../excanvas.min.js"></script><![endif]-->
		<script language="javascript" type="text/javascript" src="jquery.js"></script>
		<script language="javascript" type="text/javascript" src="jquery.flot.js"></script>
	</head>
	<body id="body">
	<script type="text/javascript">
		$(function() {
			var points = 300;
			var data = [];
			var plots = [];
			var options = {
				series: { shadowSize: 0 }, // Drawing is faster without shadows.
			        yaxis: { min: 0, max: 100 },
			        xaxis: { show: false }
			};

			updateData();

			function updateData() {
				$.ajax({
					url: 'data.php',
					success: function(new_data) {
						for (var plot in new_data) {
							var temp_data = [];
							var p = $("#" + plot);
							if (p.length == 0) {
								$("#body").append('<div style="height:50px;width:800px;margin-left:auto;margin-right:auto;"><h1>' + plot +
									'</h1></div><div id="' + plot + '" style="width:800px;height:400px;margin-left:auto;margin-right:auto;"></div>');
								p = $("#" + plot);
								plots[plot] = $.plot($("#" + plot), [], options);
							}

							if (!(plot in data)) {
								data[plot] = [];
							}

							for (var curve in new_data[plot]) {
								if (!(curve in data[plot])) {
									data[plot][curve] = [];
								}

								// Fill data with points amount of zeros.
								while (data[plot][curve].length < points) {
									data[plot][curve].push(0);
								}

								// Push in the new data and shift out the old.
								while (new_data[plot][curve].length > 0) {
									data[plot][curve].shift();
									data[plot][curve].push(new_data[plot][curve].shift());
								}

								// Zip with correct x placement on plot.
								var res = [];
								for (var i = 0; i < data[plot][curve].length; ++i) {
									res.push([i, data[plot][curve][i]]);
								}
								temp_data.push({label: curve, data: res});
							}
							plots[plot].setData(temp_data);
							plots[plot].setupGrid();
							plots[plot].draw();
						}
					},
					complete: function() {
						setTimeout(updateData, 10);
					}
				});
			}
		});

	</script>
	</body>
</html>
